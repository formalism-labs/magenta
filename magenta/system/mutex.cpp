
///////////////////////////////////////////////////////////////////////////////////////////////
// Mutex
///////////////////////////////////////////////////////////////////////////////////////////////

#include "mutex.h"

namespace magenta
{

///////////////////////////////////////////////////////////////////////////////////////////////

Mutex::Mutex(const string &name, bool initialOwner)
{
	const char *name_ = name.empty() ? 0 : name.c_str();
	_handle = CreateMutex(0, initialOwner, name_);
	if (_handle == NULL)
		THROW_OS(Exception)("mutex creation error");
}

//---------------------------------------------------------------------------------------------

Mutex::~Mutex()
{
	CloseHandle(_handle);
}

///////////////////////////////////////////////////////////////////////////////////////////////

void Mutex::release()
{
	BOOL rc = ReleaseMutex(_handle);
	if (!rc)
		THROW_OS(Exception)("mutex release error");
}

///////////////////////////////////////////////////////////////////////////////////////////////

} // namespace magenta
